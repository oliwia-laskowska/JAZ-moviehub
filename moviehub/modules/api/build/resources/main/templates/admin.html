<!doctype html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>

    <!-- Tytuł zakładki -->
    <title>Admin - MovieHub</title>


    <link rel="stylesheet" th:href="@{/css/admin.css}"/>
</head>

<body>


<h1>Panel administratora</h1>

<!-- Flash message po sync (RedirectAttributes) -->
<div th:if="${syncMessage}" class="flash">
    <b th:text="${syncMessage}"></b>
</div>

<!-- Główna karta z informacjami i akcjami -->
<div class="card">

    <!-- Wiersz z liczbą filmów + przyciski -->
    <div class="row">
        <div>
            <b>Liczba filmów:</b>
            <span th:text="${moviesCount}">0</span>
        </div>

        <!-- Formularz do uruchomienia sync (POST /admin/sync) -->
        <form th:action="@{/admin/sync}" method="post" class="formInline">
            <button type="submit">SYNC (pobierz dane z internetu)</button>
        </form>

        <!-- Formularz logout (POST /logout) -->
        <form th:action="@{/logout}" method="post" class="formInline">
            <button type="submit" class="btnLogout">Wyloguj</button>
        </form>
    </div>

    <!-- Ostatnia aktualizacja -->
    <div class="mt12">
        <b>Ostatnia aktualizacja:</b>

        <!-- Jeśli lastRun istnieje -> formatuje datę -->
        <span th:if="${lastRun != null}"
              th:text="${#temporals.format(lastRun.runAt, 'yyyy-MM-dd HH:mm:ss')}">—</span>

        <!-- Jeśli lastRun brak -->
        <span th:unless="${lastRun != null}" class="muted">brak</span>
    </div>

    <!-- Szczegóły ostatniego uruchomienia sync -->
    <div th:if="${lastRun != null}" class="grid">
        <div><b>Upserts</b></div><div th:text="${lastRun.upserts}">0</div>
        <div><b>Kto uruchomił</b></div><div th:text="${lastRun.triggeredBy}">—</div>
        <div><b>Źródło</b></div><div th:text="${lastRun.source}">UI</div>
    </div>

    <!-- Link do logów -->
    <p class="mt12">
        Logi API:
        <a th:href="${logsUrl}" target="_blank" rel="noreferrer">Otwórz</a>
        &nbsp;|&nbsp;
        <code th:text="${logsUrl}">/api/admin/logs?lines=200</code>
    </p>
</div>

<!-- Link powrotu -->
<p>
    <a th:href="@{/}">← Strona główna</a>
</p>

</body>
</html>
